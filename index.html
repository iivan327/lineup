<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>棒球打序</title>

<style>
* {
  box-sizing: border-box;
  user-select: none;
  -webkit-user-select: none;
  touch-action: none;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
}

html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  overflow: hidden;
  background: #111;
  color: #fff;
}

.container {
  display: flex;
  height: 100%;
}

.roster, .lineup {
  width: 50%;
  padding: 8px;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.title {
  text-align: center;
  font-weight: bold;
}

.item {
  background: #333;
  padding: 10px;
  border-radius: 8px;
  text-align: center;
  font-size: 16px;
}

.dragging {
  opacity: 0.3;
}

.slot {
  background: #222;
  border: 1px dashed #555;
  display: flex;
  align-items: center;
  gap: 6px;
}

.order {
  width: 24px;
  text-align: center;
  font-weight: bold;
}

.name {
  flex: 1;
}

select {
  background: #444;
  color: #fff;
  border: none;
  border-radius: 6px;
  padding: 4px;
}

.topbar {
  position: fixed;
  top: 4px;
  right: 8px;
  z-index: 10;
}

button {
  background: #a00;
  border: none;
  color: white;
  padding: 6px 12px;
  border-radius: 8px;
  font-size: 14px;
}
</style>
</head>

<body>
<div class="topbar">
  <button onclick="clearAll()">CLEAR</button>
</div>

<div class="container">
  <div class="roster" id="roster">
    <div class="title">Roster</div>
  </div>

  <div class="lineup" id="lineup">
    <div class="title">Lineup</div>
  </div>
</div>

<script>
const STORAGE_KEY = "baseball_lineup_v1";

const rosterNames = [
  "陳晨威","陳傑憲","S Fairchild","柯敬賢","宋晟睿",
  "林安可","邱志呈","林子偉","張育成","李灝宇",
  "鄭宗哲","J Long","江坤宇","吳念庭",
  "張政禹","王博玄"
  "吉力吉撈 鞏冠","林家正","戴培峰",
];

const positions = ["","C","1B","2B","3B","SS","LF","CF","RF","DH","P"];

const rosterEl = document.getElementById("roster");
const lineupEl = document.getElementById("lineup");

let dragging = null;

function saveState() {
  const roster = [...rosterEl.querySelectorAll(".item")]
    .filter(i => !i.classList.contains("slot"))
    .map(i => i.textContent);

  const lineup = [...lineupEl.querySelectorAll(".slot")].map(slot => ({
    name: slot.querySelector(".name").textContent,
    pos: slot.querySelector("select").value
  }));

  localStorage.setItem(STORAGE_KEY, JSON.stringify({ roster, lineup }));
}

function loadState() {
  const data = localStorage.getItem(STORAGE_KEY);
  if (!data) return false;

  const state = JSON.parse(data);
  state.roster.forEach(name => {
    const d = document.createElement("div");
    d.className = "item";
    d.textContent = name;
    enableDrag(d, "roster");
    rosterEl.appendChild(d);
  });

  const slots = lineupEl.querySelectorAll(".slot");
  state.lineup.forEach((s, i) => {
    if (!slots[i]) return;
    slots[i].querySelector(".name").textContent = s.name;
    slots[i].querySelector("select").value = s.pos;
  });

  return true;
}

function clearAll() {
  localStorage.removeItem(STORAGE_KEY);
  location.reload();
}

function createRoster() {
  rosterNames.forEach(name => {
    const d = document.createElement("div");
    d.className = "item";
    d.textContent = name;
    enableDrag(d, "roster");
    rosterEl.appendChild(d);
  });
}

function createLineup() {
  for (let i = 1; i <= 10; i++) {
    const d = document.createElement("div");
    d.className = "item slot";
    d.innerHTML = `
      <div class="order">${i === 10 ? "P" : i}</div>
      <div class="name"></div>
      <select>${positions.map(p=>`<option>${p}</option>`).join("")}</select>
    `;
    enableDrag(d, "lineup");

    d.querySelector("select").addEventListener("change", saveState);
    lineupEl.appendChild(d);
  }
}

function enableDrag(el, type) {
  el.addEventListener("pointerdown", e => {
    dragging = { el, type };
    el.classList.add("dragging");
    el.setPointerCapture(e.pointerId);
  });

  el.addEventListener("pointerup", e => {
    if (!dragging) return;

    const target = document.elementFromPoint(e.clientX, e.clientY);
    handleDrop(target);
    dragging.el.classList.remove("dragging");
    dragging = null;
    saveState();
  });
}

function handleDrop(target) {
  if (!target) return;

  // roster → lineup
  if (dragging.type === "roster") {
    const slot = target.closest(".slot");
    if (!slot) return;
    const nameBox = slot.querySelector(".name");
    if (nameBox.textContent) return;

    nameBox.textContent = dragging.el.textContent;
    dragging.el.remove();
  }

  // lineup → roster
  else {
    if (target.closest(".roster")) {
      const name = dragging.el.querySelector(".name").textContent;
      if (!name) return;

      const d = document.createElement("div");
      d.className = "item";
      d.textContent = name;
      enableDrag(d, "roster");
      rosterEl.appendChild(d);

      dragging.el.querySelector(".name").textContent = "";
      return;
    }

    // lineup 插隊排序
    const targetSlot = target.closest(".slot");
    if (targetSlot && targetSlot !== dragging.el) {
      const slots = [...lineupEl.querySelectorAll(".slot")];
      const from = slots.indexOf(dragging.el);
      const to = slots.indexOf(targetSlot);

      const moving = dragging.el.querySelector(".name").textContent;
      if (!moving) return;

      if (from < to) {
        for (let i = from; i < to; i++) {
          slots[i].querySelector(".name").textContent =
            slots[i+1].querySelector(".name").textContent;
          slots[i].querySelector("select").value =
            slots[i+1].querySelector("select").value;
        }
      } else {
        for (let i = from; i > to; i--) {
          slots[i].querySelector(".name").textContent =
            slots[i-1].querySelector(".name").textContent;
          slots[i].querySelector("select").value =
            slots[i-1].querySelector("select").value;
        }
      }

      targetSlot.querySelector(".name").textContent = moving;
      targetSlot.querySelector("select").value =
        dragging.el.querySelector("select").value;

      dragging.el.querySelector(".name").textContent = "";
      dragging.el.querySelector("select").value = "";
    }
  }
}

createLineup();

if (!loadState()) {
  createRoster();
}
</script>
</body>
</html>
