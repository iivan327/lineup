<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>投手用球數（WBC）</title>

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont;
}

.wrapper {
  overflow-x: auto;
}

table {
  border-collapse: collapse;
  width: max-content;
}

th, td {
  border: 1px solid #ccc;
  text-align: center;
  padding: 2px;
  height: 28px;
  min-width: 70px;
  font-size: 13px;
}

thead th {
  position: sticky;
  top: 0;
  background: #f8f8f8;
  z-index: 3;
}

.pitcher {
  position: sticky;
  left: 0;
  background: #fff;
  z-index: 2;
  min-width: 90px;
  text-align: left;
  padding-left: 6px;
}

input {
  width: 48px;
  height: 24px;
  font-size: 14px;
  text-align: center;
  border-radius: 6px;
  border: 1px solid #aaa;
}

.low { background: #fff; }
.mid { background: #ffe08a; }
.high { background: #ff9b9b; }

.blocked {
  background: #eee;
  color: #999;
  font-weight: bold;
}
</style>
</head>

<body>

<div class="wrapper">
<table id="tbl">
  <thead>
    <tr>
      <th class="pitcher">投手</th>
      <th>3/5</th>
      <th>3/6</th>
      <th>3/7</th>
      <th>3/8</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
</div>

<script>
const pitchers = [
  "林昱珉","林維恩","徐若熙","古林睿煬","鄭浩均","莊陳仲敖","陳柏毓","胡智爲",
  "張奕","沙子宸","孫易磊","張峻瑋","陳冠宇","林凱威","林詩翔","曾峻岳",
];

const days = 4;
const key = "pitchCountWBC";
const data = JSON.parse(localStorage.getItem(key) || "{}");

const tbody = document.querySelector("tbody");

pitchers.forEach((p, r) => {
  const tr = document.createElement("tr");
  tr.innerHTML = `<td class="pitcher">${p}</td>`;
  for (let d = 0; d < days; d++) {
    const td = document.createElement("td");
    const input = document.createElement("input");
    input.type = "number";
    input.min = 0;
    input.value = data[`${r}-${d}`] || "";
    input.oninput = () => update();
    input.dataset.r = r;
    input.dataset.d = d;
    td.appendChild(input);
    tr.appendChild(td);
  }
  tbody.appendChild(tr);
});

function update() {
  localStorage.clear();
  reset();

  pitchers.forEach((_, r) => {
    let lastDay = -10;

    for (let d = 0; d < days; d++) {
      const cell = getCell(r, d);
      const input = cell.querySelector("input");
      if (!input) continue;

      const val = Number(input.value);
      if (!val) continue;

      localStorage.setItem(`${r}-${d}`, val);

      input.className = val >= 50 ? "high" : val >= 30 ? "mid" : "low";

      if (d - lastDay === 1 && d + 1 < days) block(r, d + 1);
      if (val >= 30 && val < 50 && d + 1 < days) block(r, d + 1);
      if (val >= 50) for (let k = d + 1; k < days; k++) block(r, k);

      lastDay = d;
    }
  });
}

function reset() {
  document.querySelectorAll("td").forEach(td => {
    td.classList.remove("blocked");
    const i = td.querySelector("input");
    if (i) i.disabled = false;
    if (td.textContent === "X") td.innerHTML = "";
  });
}

function block(r, d) {
  const cell = getCell(r, d);
  if (cell.querySelector("input")) {
    cell.innerHTML = "X";
    cell.classList.add("blocked");
  }
}

function getCell(r, d) {
  return tbody.children[r].children[d + 1];
}

update();
</script>

</body>
</html>
